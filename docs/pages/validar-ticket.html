<script>
    const params = new URLSearchParams(window.location.search);
    const qr = params.get("qr");   // <<< CORRETO AGORA

    if (!qr) {
        document.getElementById("erro").classList.remove("hidden");
    } else {

        // ROTA CORRETA
        fetch(`https://guia-rq-backend.onrender.com/api/tickets/validar/${qr}`)
            .then(res => res.json())
            .then(ticket => {

                if (ticket.status === "INVALIDO") {
                    document.getElementById("erro").classList.remove("hidden");
                    return;
                }

                if (ticket.usado === true) {
                    document.getElementById("usado").classList.remove("hidden");
                    return;
                }

                document.getElementById("nomeCliente").innerText = ticket.cliente;
                document.getElementById("nomeTicket").innerText = ticket.ticket;
                document.getElementById("card").classList.remove("hidden");
            })
    }

    function confirmarTicket() {
        fetch(`https://guia-rq-backend.onrender.com/api/tickets/confirmar/${qr}`, {
            method: "POST"
        })
        .then(async res => {
            if (res.status === 200) {
                alert("âœ” Ticket confirmado com sucesso!");
                location.reload();
            }

            if (res.status === 409) {
                document.getElementById("usado").classList.remove("hidden");
            }

            if (res.status === 404) {
                document.getElementById("erro").classList.remove("hidden");
            }
        });
    }
</script>
