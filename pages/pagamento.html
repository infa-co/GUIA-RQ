<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    ::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="bg-gray-50 overflow-y-auto min-h-screen">
  
  <!-- Cabeçalho -->
  <header id="header" class="bg-white shadow-sm fixed top-0 w-full z-50">
    <div class="px-4 py-3 flex items-center justify-between">
      <!-- Logo -->
   
<a href="../index.html" class="flex items-center space-x-2 group">
  <img src="../assets/images/guia-rancho-queimado-logo-sem-fundo.png"
       alt="Logo Guia RQ"
       class="h-12 sm:h-14 w-auto transition-transform group-hover:scale-105">
  <span class="text-lg sm:text-xl font-semibold text-gray-800 group-hover:text-blue-600 transition-colors">
    Guia RQ
  </span>
</a>
  </header>

  <!-- Conteúdo -->
  <main id="main-content" class="pt-20 pb-32 overflow-y-auto">

    <!-- Resumo do pedido -->
    <section id="order-summary" class="bg-white border-b border-gray-100">
  <div id="order-content" class="px-4 py-4">
    <!-- Conteúdo será injetado aqui via JavaScript -->
  </div>
</section>

    <!-- Dados pessoais -->
    <section id="personal-data" class="px-4 py-6">
      <div class="mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-1">Dados Pessoais</h2>
        <p class="text-sm text-gray-600">Preencha seus dados para finalizar a reserva</p>
      </div>
      
      <form id="personal-form" class="space-y-4">
        <input type="text" placeholder="Seu nome completo" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600" id="nome">
        <input type="email" placeholder="seu@email.com" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600" id="email">
        <input type="tel" placeholder="(48) 99999-9999" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600" id="telefone">
      </form>

      <div id="user-logged" class="hidden bg-green-50 border border-green-200 rounded-xl p-4 mt-3 text-sm text-green-700 flex items-center justify-between">
        <div><i class="fa-solid fa-user-check mr-2"></i>Dados carregados automaticamente</div>
        <button class="text-xs underline text-green-700" id="logout">Sair</button>
      </div>
    </section>

    <!-- Métodos de pagamento -->
    <section id="payment-methods" class="px-4 py-6 bg-white">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Método de Pagamento</h2>
      
      <div class="space-y-3">
        <div class="payment-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-600" onclick="selectPayment('credit', event)">
          <div class="flex justify-between items-center">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center">
                <i class="fa-solid fa-credit-card text-blue-600"></i>
              </div>
              <div>
                <div class="font-medium text-gray-900">Cartão de Crédito</div>
                <div class="text-sm text-gray-600">Até 12x sem juros</div>
              </div>
            </div>
          </div>
        </div>

        <div id="credit-card-form" class="hidden mt-4 bg-gray-50 p-4 rounded-xl space-y-3">
          <input type="text" placeholder="Número do cartão" maxlength="16" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600">
          <div class="flex space-x-3">
            <input type="text" placeholder="MM/AA" class="w-1/2 px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600">
            <input type="text" placeholder="CVV" maxlength="3" class="w-1/2 px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-600">
          </div>
          <button id="save-card" class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition">Salvar Cartão</button>
          <p id="card-saved" class="hidden text-green-600 text-sm font-medium text-center mt-2"><i class="fa-solid fa-check mr-1"></i> Cartão salvo com sucesso!</p>
        </div>

        <div class="payment-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-600" onclick="selectPayment('pix', event)">
          <div class="flex justify-between items-center">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-green-50 rounded-full flex items-center justify-center">
                <i class="fa-solid fa-qrcode text-green-600"></i>
              </div>
              <div>
                <div class="font-medium text-gray-900">PIX</div>
                <div class="text-sm text-gray-600">Aprovação instantânea</div>
              </div>
            </div>
            </div>

          </div class="payment-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-600" onclick="selectPayment('wallet')">
                    <div 
  class="payment-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-600 transition-colors" 
  onclick="selectPayment('wallet', event)"
>
  <div class="flex justify-between items-center">
    
    <div class="flex items-center space-x-3">
      <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
        <i class="fa-solid fa-wallet text-gray-600"></i>
      </div>
      <div>
        <div class="font-medium text-gray-900">Carteira Digital</div>
        <div class="text-sm text-gray-600">Apple Pay, Google Pay</div>
      </div>
    </div>

    <!-- Ícones alinhados -->
    <div class="flex items-center space-x-3">
      <div class="flex items-center justify-center bg-black text-white px-2.5 py-1 rounded-md text-[13px] font-semibold">
         Pay
      </div>
      <div class="flex items-center justify-center bg-[#4285F4] text-white px-2.5 py-1 rounded-md text-[13px] font-semibold">
        G Pay
      </div>
  </section>

   

<section id="upsell" class="px-4 py-6">
            <div class="mb-4">
                <h2 class="text-lg font-semibold text-gray-900 mb-1">Antes de finalizar, adicione e ganhe mais benefícios</h2>
                <p class="text-sm text-gray-600">Ofertas especiais por tempo limitado</p>
            </div>
            
            <div class="space-y-3">
                <div class="border border-gray-200 rounded-xl p-4">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" class="mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <i class="fa-solid fa-beer-mug-empty"></i>
                                <span class="font-medium text-gray-900 text-sm">1 Chopp na Bier Haus</span>
                                <span class="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full font-medium">+R$ 10</span>
                            </div>
                            <p class="text-xs text-gray-600">Garanta seu chopp por apenas R$10</p>
                        </div>
                    </div>
                </div>
                
                <div class="border border-gray-200 rounded-xl p-4">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" class="mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <i class="fa-solid fa-percent text-success"></i>
                                <span class="font-medium text-gray-900 text-sm">Leve mais um Ticket surpresa com garantia de 100% de retorno</span>
                                <span class="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full font-medium">+R$ 22</span>
                            </div>
                            <p class="text-xs text-gray-600">Cupom válido por 30 dias para sua próxima experiência no Guia RQ</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

  <!-- Rodapé fixo do checkout -->
<div id="checkout-footer" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-[60] shadow-lg">
  <button id="pay-btn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold text-base hover:bg-blue-700 transition">
    Finalizar Compra
  </button>
</div>

<script>
  document.getElementById("pay-btn").addEventListener("click", () => {
    const resumo = JSON.parse(localStorage.getItem("resumo"));
    const carrinho = JSON.parse(localStorage.getItem("carrinho"));
    
    // Exemplo: enviar via webhook
    fetch("https://seuservidor.com/api/checkout", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ carrinho, resumo }),
    })
    .then(() => {
      window.location.href = "../pages/sucesso.html";
    });
  });
</script>
  </div>

  <script>
    // ======== LOGIN SIMPLIFICADO ========
    const form = document.getElementById('personal-form');
    const loggedSection = document.getElementById('user-logged');

    // Verifica se usuário está logado
    const userData = JSON.parse(localStorage.getItem('usuarioRQ'));
    if (userData) {
      form.classList.add('hidden');
      loggedSection.classList.remove('hidden');
    }

    // Logout
    document.getElementById('logout').addEventListener('click', () => {
      localStorage.removeItem('usuarioRQ');
      location.reload();
    });

    // ======== PAGAMENTO ========
    function selectPayment(type, event) {
      document.querySelectorAll('.payment-option').forEach(opt => {
        opt.classList.remove('border-blue-600', 'bg-blue-50');
        opt.classList.add('border-gray-200');
      });
      event.currentTarget.classList.add('border-blue-600', 'bg-blue-50');

      const cardForm = document.getElementById('credit-card-form');
      cardForm.classList.toggle('hidden', type !== 'credit');
    }

    // Salvar cartão
    document.getElementById('save-card').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.setItem('cardSaved', 'true');
      document.getElementById('card-saved').classList.remove('hidden');
    });

    // Mostrar se o cartão já foi salvo antes
    if (localStorage.getItem('cardSaved') === 'true') {
      document.getElementById('credit-card-form').innerHTML = `
        <div class="flex items-center justify-between bg-green-50 p-3 rounded-xl">
          <div class="flex items-center text-green-700">
            <i class="fa-solid fa-credit-card mr-2"></i>
            <span>Cartão salvo e pronto para uso</span>
          </div>
          <button class="text-xs text-red-600 underline" onclick="localStorage.removeItem('cardSaved'); location.reload();">Remover</button>
        </div>`;
    }
  </script>
  <script>

document.addEventListener("DOMContentLoaded", () => {
  const resumoEl = document.querySelector("#order-content");
  const checkboxes = document.querySelectorAll("#upsell input[type='checkbox']");

  // 🔹 Recupera dados do localStorage
  const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  let resumo = JSON.parse(localStorage.getItem("resumoCompra")) || {};
  const upsellsCatalogo = JSON.parse(localStorage.getItem("upsells")) || {};
  let upsellsSelecionados = JSON.parse(localStorage.getItem("upsellsSelecionados")) || [];

  const basePath = "../assets/images/";

  // ==============================
  // 🔹 MONTA VISUAL DO RESUMO
  if (carrinho.length === 0) {
    resumoEl.innerHTML = `<div class='p-6 text-center text-gray-600'>Nenhum item no carrinho.</div>`;
    return;
  }

  const itemsHTML = carrinho.map(item => `
    <div class="flex items-start space-x-3 mb-3">
     <img 
  class="w-16 h-16 rounded-lg object-cover"
  src="${(() => {
    if (!item.img) return basePath + 'default.jpg';
    if (item.img.startsWith('http')) return item.img;

    // GitHub Pages (infa-co.github.io)
    if (window.location.hostname.includes('github.io')) {
      return '/GUIA-RQ/' + item.img.replace(/^(\.\.\/)+/, '');
    }

    // Go Live / Localhost
    return item.img.startsWith('../') ? item.img : '../' + item.img;
  })()}"
  onerror="this.src='${basePath}default.jpg';"
/>
      <div class="flex-1 min-w-0">
        <h3 class="font-semibold text-gray-900 text-sm mb-1">${item.nome}</h3>
        <div class="text-xs text-gray-600">${item.local || 'Rancho Queimado'}</div>
      </div>
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap">
        R$ ${(item.preco * (item.qtd || 1)).toFixed(2)}
      </span>
    </div>
  `).join("");

  // 🔹 Filtra upsells que estavam ativos
  const upsellsAtivos = upsellsSelecionados
    .map(id => upsellsCatalogo[id])
    .filter(Boolean);

  const upsellsHTML = upsellsAtivos.map(u => `
    <div class="flex items-start space-x-3 mb-3">
      <img class="w-14 h-14 rounded-lg object-cover"
           src="${u.img || basePath + 'default.jpg'}"
           onerror="this.src='${basePath}default.jpg';" />
      <div class="flex-1">
        <h4 class="text-sm font-medium text-gray-900 mb-0.5">+ ${u.nome}</h4>
        <p class="text-xs text-gray-600">Benefício adicional</p>
      </div>
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap">
        R$ ${u.preco.toFixed(2)}
      </span>
    </div>
  `).join("");

  // 🔹 Soma valores
  const subtotalCarrinho = carrinho.reduce((acc, i) => acc + i.preco * (i.qtd || 1), 0);
  const totalUpsells = upsellsAtivos.reduce((acc, u) => acc + u.preco, 0);
  const taxa = parseFloat(resumo.taxa || 0);
  const subtotal = subtotalCarrinho + totalUpsells;
  const totalFinal = subtotal + taxa;

  // 🔹 Renderiza resumo
  resumoEl.innerHTML = `
    <div class="bg-gray-50 rounded-xl p-4">
      ${itemsHTML}
      ${upsellsHTML ? `<div class="mt-2 border-t border-gray-200 pt-3">${upsellsHTML}</div>` : ""}
      <div class="mt-4 pt-3 border-t border-gray-200 space-y-2">
        <div class="flex justify-between text-sm">
          <span class="text-gray-600">Subtotal</span>
          <span class="text-gray-900 subtotal-valor">R$ ${subtotal.toFixed(2)}</span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-gray-600">Taxa de serviço</span>
          <span class="text-gray-900 taxa-valor">R$ ${taxa.toFixed(2)}</span>
        </div>
        <div class="flex justify-between text-base font-semibold pt-2 border-t border-gray-200">
          <span class="text-gray-900">Total</span>
          <span class="text-gray-900 total-valor">R$ ${totalFinal.toFixed(2)}</span>
        </div>
      </div>
    </div>
  `;

  // 🔹 Atualiza localStorage com os valores iniciais corrigidos
  resumo = { subtotal, taxa, totalFinal };
  localStorage.setItem("resumoCompra", JSON.stringify(resumo));

  // ==============================
  // 🔹 CHECKBOXES DE UPSELL (DINÂMICOS)
  // Cada checkbox deve ter os atributos:
  // data-id, data-nome e data-preco
  checkboxes.forEach((checkbox, index) => {
    // Configura atributos se ainda não existirem
    if (!checkbox.dataset.id) checkbox.dataset.id = `extra-${index + 1}`;
    if (!checkbox.dataset.nome) checkbox.dataset.nome = checkbox.nextElementSibling?.querySelector("span.font-medium")?.textContent?.trim() || `Extra ${index+1}`;
    if (!checkbox.dataset.preco) {
      const precoTexto = checkbox.nextElementSibling?.querySelector("span.bg-green-100")?.textContent || "";
      const valor = parseFloat(precoTexto.replace(/[^\d,]/g, "").replace(",", "."));
      checkbox.dataset.preco = isNaN(valor) ? 0 : valor;
    }

    // Marca se já estiver no localStorage
    if (upsellsSelecionados.includes(checkbox.dataset.id)) {
      checkbox.checked = true;
    }

    // Evento de clique
    checkbox.addEventListener("change", () => {
      const id = checkbox.dataset.id;
      const nome = checkbox.dataset.nome;
      const preco = parseFloat(checkbox.dataset.preco);
      const img = "../assets/images/default.jpg";

      if (checkbox.checked) {
        upsellsCatalogo[id] = { nome, preco, ativo: true, img };
        upsellsSelecionados.push(id);
      } else {
        delete upsellsCatalogo[id];
        upsellsSelecionados = upsellsSelecionados.filter(u => u !== id);
      }

      localStorage.setItem("upsells", JSON.stringify(upsellsCatalogo));
      localStorage.setItem("upsellsSelecionados", JSON.stringify(upsellsSelecionados));

      atualizarResumo();
    });
  });

  // ==============================
  // 🔹 Função para recalcular e atualizar resumo visual
  function atualizarResumo() {
    const upsellsAtivosNovos = upsellsSelecionados
      .map(id => upsellsCatalogo[id])
      .filter(Boolean);

    const totalExtras = upsellsAtivosNovos.reduce((a, b) => a + b.preco, 0);
    const subtotalBase = subtotalCarrinho + totalExtras;
    const totalNovo = subtotalBase + taxa;

    resumo.subtotal = subtotalBase;
    resumo.totalFinal = totalNovo;
    localStorage.setItem("resumoCompra", JSON.stringify(resumo));

    document.querySelector(".subtotal-valor").textContent = `R$ ${subtotalBase.toFixed(2)}`;
    document.querySelector(".total-valor").textContent = `R$ ${totalNovo.toFixed(2)}`;
  }
});
</script>
</body>
</html>



